// test_ara_basic.aria
// Basic test of Aria Runtime Assembler
// Tests instruction encoding without actual execution

%include "../lib/stdlib/ara.aria"

func:main = int8() {
    print("=== ARA Basic Encoding Test ===");
    
    // Create assembler with 1KB buffer
    Assembler:asm = create(1024);
    
    print("Step 1: Assembler created");
    
    // Create operands using helper functions
    Operand:rax = reg(REG_RAX);
    Operand:rdi = reg(REG_RDI);
    Operand:ten = imm(10);
    Operand:five = imm(5);
    
    print("Step 2: Operands created");
    
    // Generate code using fluent API
    // This generates: f(x) = (x + 10) - 5
    // mov rax, rdi
    // add rax, 10
    // sub rax, 5
    // ret
    
    asm = mov(asm, rax, rdi);
    print("  - Encoded: MOV RAX, RDI");
    
    asm = add(asm, rax, ten);
    print("  - Encoded: ADD RAX, 10");
    
    asm = sub(asm, rax, five);
    print("  - Encoded: SUB RAX, 5");
    
    asm = ret(asm);
    print("  - Encoded: RET");
    
    print("Step 3: Instructions encoded");
    
    // Check cursor position to verify bytes were written
    print("  Total bytes generated:");
    // Expected: ~15-20 bytes for this sequence
    
    print("");
    print("âœ“ ARA encoding test complete!");
    print("  (Actual execution requires mem intrinsics)");
    
    return 0;
};
