; ModuleID = 'aria_module'
source_filename = "aria_module"

%result_uint8 = type { i8, i8 }
%result_int8 = type { i8, i8 }

@REG_RAX = internal global i8 0
@REG_RDI = internal global i8 7
@0 = private unnamed_addr constant [23 x i8] c"MOV RAX, RDI encoding:\00", align 1
@1 = private unnamed_addr constant [12 x i8] c"  REX: 0x48\00", align 1
@2 = private unnamed_addr constant [15 x i8] c"  Opcode: 0x89\00", align 1
@3 = private unnamed_addr constant [15 x i8] c"  ModR/M: 0xF8\00", align 1
@4 = private unnamed_addr constant [21 x i8] c"  Complete: 48 89 F8\00", align 1
@5 = private unnamed_addr constant [22 x i8] c"ADD RAX, 10 encoding:\00", align 1
@6 = private unnamed_addr constant [12 x i8] c"  REX: 0x48\00", align 1
@7 = private unnamed_addr constant [15 x i8] c"  Opcode: 0x83\00", align 1
@8 = private unnamed_addr constant [15 x i8] c"  ModR/M: 0xC0\00", align 1
@9 = private unnamed_addr constant [13 x i8] c"  Imm8: 0x0A\00", align 1
@10 = private unnamed_addr constant [24 x i8] c"  Complete: 48 83 C0 0A\00", align 1
@11 = private unnamed_addr constant [21 x i8] c"SUB RAX, 5 encoding:\00", align 1
@12 = private unnamed_addr constant [12 x i8] c"  REX: 0x48\00", align 1
@13 = private unnamed_addr constant [15 x i8] c"  Opcode: 0x83\00", align 1
@14 = private unnamed_addr constant [15 x i8] c"  ModR/M: 0xE8\00", align 1
@15 = private unnamed_addr constant [13 x i8] c"  Imm8: 0x05\00", align 1
@16 = private unnamed_addr constant [24 x i8] c"  Complete: 48 83 E8 05\00", align 1
@17 = private unnamed_addr constant [14 x i8] c"RET encoding:\00", align 1
@18 = private unnamed_addr constant [15 x i8] c"  Opcode: 0xC3\00", align 1
@19 = private unnamed_addr constant [41 x i8] c"========================================\00", align 1
@20 = private unnamed_addr constant [32 x i8] c"  Aria Runtime Assembler - Demo\00", align 1
@21 = private unnamed_addr constant [41 x i8] c"========================================\00", align 1
@22 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@23 = private unnamed_addr constant [30 x i8] c"Encoding: f(x) = (x + 10) - 5\00", align 1
@24 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@25 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@26 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@27 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@28 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@29 = private unnamed_addr constant [41 x i8] c"========================================\00", align 1
@30 = private unnamed_addr constant [19 x i8] c"Full machine code:\00", align 1
@31 = private unnamed_addr constant [35 x i8] c"48 89 F8              MOV RAX, RDI\00", align 1
@32 = private unnamed_addr constant [34 x i8] c"48 83 C0 0A           ADD RAX, 10\00", align 1
@33 = private unnamed_addr constant [33 x i8] c"48 83 E8 05           SUB RAX, 5\00", align 1
@34 = private unnamed_addr constant [26 x i8] c"C3                    RET\00", align 1
@35 = private unnamed_addr constant [1 x i8] zeroinitializer, align 1
@36 = private unnamed_addr constant [16 x i8] c"Total: 12 bytes\00", align 1
@37 = private unnamed_addr constant [41 x i8] c"========================================\00", align 1

declare void @puts(ptr)

declare void @print(ptr)

define internal void @__aria_module_init() {
entry:
  ret void
}

define internal %result_uint8 @calc_rex_byte(i8 %w_flag, i8 %r_idx, i8 %rm_idx) {
entry:
  %rex = alloca i8, align 1
  %needs_rex = alloca i8, align 1
  %needs_b = alloca i8, align 1
  %needs_r = alloca i8, align 1
  %w_flag1 = alloca i8, align 1
  store i8 %w_flag, ptr %w_flag1, align 1
  %r_idx2 = alloca i8, align 1
  store i8 %r_idx, ptr %r_idx2, align 1
  %rm_idx3 = alloca i8, align 1
  store i8 %rm_idx, ptr %rm_idx3, align 1
  store i8 0, ptr %needs_r, align 1
  store i8 0, ptr %needs_b, align 1
  %0 = load i64, ptr %r_idx2, align 4
  %gttmp = icmp sgt i64 %0, 7
  br i1 %gttmp, label %then, label %ifcont

then:                                             ; preds = %entry
  store i8 1, ptr %needs_r, align 1
  br label %ifcont

ifcont:                                           ; preds = %then, %entry
  %1 = load i64, ptr %rm_idx3, align 4
  %gttmp4 = icmp sgt i64 %1, 7
  br i1 %gttmp4, label %then5, label %ifcont6

then5:                                            ; preds = %ifcont
  store i8 1, ptr %needs_b, align 1
  br label %ifcont6

ifcont6:                                          ; preds = %then5, %ifcont
  store i8 0, ptr %needs_rex, align 1
  %2 = load i64, ptr %w_flag1, align 4
  %netmp = icmp ne i64 %2, 0
  br i1 %netmp, label %then7, label %ifcont8

then7:                                            ; preds = %ifcont6
  store i8 1, ptr %needs_rex, align 1
  br label %ifcont8

ifcont8:                                          ; preds = %then7, %ifcont6
  %3 = load i8, ptr %needs_r, align 1
  %4 = sext i8 %3 to i64
  %netmp9 = icmp ne i64 %4, 0
  br i1 %netmp9, label %then10, label %ifcont11

then10:                                           ; preds = %ifcont8
  store i8 1, ptr %needs_rex, align 1
  br label %ifcont11

ifcont11:                                         ; preds = %then10, %ifcont8
  %5 = load i8, ptr %needs_b, align 1
  %6 = sext i8 %5 to i64
  %netmp12 = icmp ne i64 %6, 0
  br i1 %netmp12, label %then13, label %ifcont14

then13:                                           ; preds = %ifcont11
  store i8 1, ptr %needs_rex, align 1
  br label %ifcont14

ifcont14:                                         ; preds = %then13, %ifcont11
  %7 = load i8, ptr %needs_rex, align 1
  %8 = sext i8 %7 to i64
  %eqtmp = icmp eq i64 %8, 0
  br i1 %eqtmp, label %then15, label %ifcont16

then15:                                           ; preds = %ifcont14
  %auto_wrap_result = alloca %result_uint8, align 8
  %err_ptr = getelementptr inbounds %result_uint8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_uint8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_uint8, ptr %auto_wrap_result, align 1
  ret %result_uint8 %result_val

ifcont16:                                         ; preds = %ifcont14
  store i8 64, ptr %rex, align 1
  %9 = load i64, ptr %w_flag1, align 4
  %netmp17 = icmp ne i64 %9, 0
  br i1 %netmp17, label %then18, label %ifcont19

then18:                                           ; preds = %ifcont16
  %10 = load i8, ptr %rex, align 1
  %11 = sext i8 %10 to i64
  br label %ifcont19

ifcont19:                                         ; preds = %then18, %ifcont16
  %12 = load i8, ptr %needs_r, align 1
  %13 = sext i8 %12 to i64
  %netmp20 = icmp ne i64 %13, 0
  br i1 %netmp20, label %then21, label %ifcont22

then21:                                           ; preds = %ifcont19
  %14 = load i8, ptr %rex, align 1
  %15 = sext i8 %14 to i64
  br label %ifcont22

ifcont22:                                         ; preds = %then21, %ifcont19
  %16 = load i8, ptr %needs_b, align 1
  %17 = sext i8 %16 to i64
  %netmp23 = icmp ne i64 %17, 0
  br i1 %netmp23, label %then24, label %ifcont25

then24:                                           ; preds = %ifcont22
  %18 = load i8, ptr %rex, align 1
  %19 = sext i8 %18 to i64
  br label %ifcont25

ifcont25:                                         ; preds = %then24, %ifcont22
  %20 = load i8, ptr %rex, align 1
  %auto_wrap_result26 = alloca %result_uint8, align 8
  %err_ptr27 = getelementptr inbounds %result_uint8, ptr %auto_wrap_result26, i32 0, i32 0
  store i8 0, ptr %err_ptr27, align 1
  %val_ptr28 = getelementptr inbounds %result_uint8, ptr %auto_wrap_result26, i32 0, i32 1
  store i8 %20, ptr %val_ptr28, align 1
  %result_val29 = load %result_uint8, ptr %auto_wrap_result26, align 1
  ret %result_uint8 %result_val29
}

define internal %result_uint8 @calc_modrm_byte(i8 %reg_field, i8 %rm_field, i8 %mod_field) {
entry:
  %output = alloca i8, align 1
  %rmval = alloca i8, align 1
  %regval = alloca i8, align 1
  %modval = alloca i8, align 1
  %reg_field1 = alloca i8, align 1
  store i8 %reg_field, ptr %reg_field1, align 1
  %rm_field2 = alloca i8, align 1
  store i8 %rm_field, ptr %rm_field2, align 1
  %mod_field3 = alloca i8, align 1
  store i8 %mod_field, ptr %mod_field3, align 1
  store i8 0, ptr %modval, align 1
  store i8 0, ptr %regval, align 1
  store i8 0, ptr %rmval, align 1
  store i8 0, ptr %output, align 1
  %0 = load i64, ptr %mod_field3, align 4
  %bandtmp = and i64 %0, 3
  %1 = trunc i64 %bandtmp to i8
  store i8 %1, ptr %modval, align 1
  %2 = load i64, ptr %reg_field1, align 4
  %bandtmp4 = and i64 %2, 7
  %3 = trunc i64 %bandtmp4 to i8
  store i8 %3, ptr %regval, align 1
  %4 = load i64, ptr %rm_field2, align 4
  %bandtmp5 = and i64 %4, 7
  %5 = trunc i64 %bandtmp5 to i8
  store i8 %5, ptr %rmval, align 1
  %6 = load i8, ptr %modval, align 1
  %7 = sext i8 %6 to i64
  %shltmp = shl i64 %7, 6
  %8 = trunc i64 %shltmp to i8
  store i8 %8, ptr %output, align 1
  %9 = load i8, ptr %output, align 1
  %10 = load i8, ptr %regval, align 1
  %11 = sext i8 %10 to i64
  %shltmp6 = shl i64 %11, 3
  %12 = sext i8 %9 to i64
  %13 = load i8, ptr %output, align 1
  %14 = load i8, ptr %rmval, align 1
  %15 = load i8, ptr %output, align 1
  %auto_wrap_result = alloca %result_uint8, align 8
  %err_ptr = getelementptr inbounds %result_uint8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_uint8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 %15, ptr %val_ptr, align 1
  %result_val = load %result_uint8, ptr %auto_wrap_result, align 1
  ret %result_uint8 %result_val
}

define internal %result_int8 @demo_mov_rax_rdi() {
entry:
  %modrm = alloca i8, align 1
  %rex = alloca i8, align 1
  call void @puts(ptr @0)
  %calltmp = call %result_uint8 @calc_rex_byte(i8 1, i8 7, i8 0)
  store %result_uint8 %calltmp, ptr %rex, align 1
  call void @puts(ptr @1)
  call void @puts(ptr @2)
  %calltmp1 = call %result_uint8 @calc_modrm_byte(i8 7, i8 0, i8 3)
  store %result_uint8 %calltmp1, ptr %modrm, align 1
  call void @puts(ptr @3)
  call void @puts(ptr @4)
  %auto_wrap_result = alloca %result_int8, align 8
  %err_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_int8, ptr %auto_wrap_result, align 1
  ret %result_int8 %result_val
}

define internal %result_int8 @demo_add_rax_10() {
entry:
  %modrm = alloca i8, align 1
  %rex = alloca i8, align 1
  call void @puts(ptr @5)
  %calltmp = call %result_uint8 @calc_rex_byte(i8 1, i8 0, i8 0)
  store %result_uint8 %calltmp, ptr %rex, align 1
  call void @puts(ptr @6)
  call void @puts(ptr @7)
  %calltmp1 = call %result_uint8 @calc_modrm_byte(i8 0, i8 0, i8 3)
  store %result_uint8 %calltmp1, ptr %modrm, align 1
  call void @puts(ptr @8)
  call void @puts(ptr @9)
  call void @puts(ptr @10)
  %auto_wrap_result = alloca %result_int8, align 8
  %err_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_int8, ptr %auto_wrap_result, align 1
  ret %result_int8 %result_val
}

define internal %result_int8 @demo_sub_rax_5() {
entry:
  %modrm = alloca i8, align 1
  %rex = alloca i8, align 1
  call void @puts(ptr @11)
  %calltmp = call %result_uint8 @calc_rex_byte(i8 1, i8 0, i8 0)
  store %result_uint8 %calltmp, ptr %rex, align 1
  call void @puts(ptr @12)
  call void @puts(ptr @13)
  %calltmp1 = call %result_uint8 @calc_modrm_byte(i8 5, i8 0, i8 3)
  store %result_uint8 %calltmp1, ptr %modrm, align 1
  call void @puts(ptr @14)
  call void @puts(ptr @15)
  call void @puts(ptr @16)
  %auto_wrap_result = alloca %result_int8, align 8
  %err_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_int8, ptr %auto_wrap_result, align 1
  ret %result_int8 %result_val
}

define internal %result_int8 @demo_ret() {
entry:
  call void @puts(ptr @17)
  call void @puts(ptr @18)
  %auto_wrap_result = alloca %result_int8, align 8
  %err_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_int8, ptr %auto_wrap_result, align 1
  ret %result_int8 %result_val
}

define internal %result_int8 @__user_main() {
entry:
  call void @puts(ptr @19)
  call void @puts(ptr @20)
  call void @puts(ptr @21)
  call void @puts(ptr @22)
  call void @puts(ptr @23)
  call void @puts(ptr @24)
  %calltmp = call %result_int8 @demo_mov_rax_rdi()
  call void @puts(ptr @25)
  %calltmp1 = call %result_int8 @demo_add_rax_10()
  call void @puts(ptr @26)
  %calltmp2 = call %result_int8 @demo_sub_rax_5()
  call void @puts(ptr @27)
  %calltmp3 = call %result_int8 @demo_ret()
  call void @puts(ptr @28)
  call void @puts(ptr @29)
  call void @puts(ptr @30)
  call void @puts(ptr @31)
  call void @puts(ptr @32)
  call void @puts(ptr @33)
  call void @puts(ptr @34)
  call void @puts(ptr @35)
  call void @puts(ptr @36)
  call void @puts(ptr @37)
  %auto_wrap_result = alloca %result_int8, align 8
  %err_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 0
  store i8 0, ptr %err_ptr, align 1
  %val_ptr = getelementptr inbounds %result_int8, ptr %auto_wrap_result, i32 0, i32 1
  store i8 0, ptr %val_ptr, align 1
  %result_val = load %result_int8, ptr %auto_wrap_result, align 1
  ret %result_int8 %result_val
}

define i64 @main() {
entry:
  call void @__aria_module_init()
  %0 = call %result_int8 @__user_main()
  ret i64 0
}
