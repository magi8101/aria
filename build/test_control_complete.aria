// ============================================================================
// Comprehensive Control Flow Macro Test Suite
// ============================================================================

%macro IF 3
if (%1 %2 %3) {
%endmacro

%macro ELSE 0
} else {
%endmacro

%macro ELIF 3
} else if (%1 %2 %3) {
%endmacro

%macro END_IF 0
}
%endmacro

%macro WHILE 3
while (%1 %2 %3) {
%endmacro

%macro END_WHILE 0
}
%endmacro

// Test 1: IF/ELSE
func:test_if_else = *int8(int32:x) {
    int8:ret = 0;
    IF(x, >, 10)
        ret = 1;
    ELSE
        ret = 0;
    END_IF
    return ret;
};

// Test 2: IF/ELIF/ELSE
func:test_elif = *int8(int32:x) {
    int8:ret = 0;
    IF(x, ==, 1)
        ret = 10;
    ELIF(x, ==, 2)
        ret = 20;
    ELIF(x, ==, 3)
        ret = 30;
    ELSE
        ret = 99;
    END_IF
    return ret;
};

// Test 3: WHILE loop
func:test_while = *int32() {
    int32:sum = 0;
    int32:counter = 0;
    WHILE(counter, <, 5)
        sum = sum + counter;
        counter = counter + 1;
    END_WHILE
    return sum;
};

// Test 4: Nested IF
func:test_nested = *int8(int32:x) {
    int8:ret = 0;
    IF(x, >, 10)
        IF(x, <, 50)
            ret = 1;
        END_IF
    END_IF
    return ret;
};

func:main = *int8() {
    int8:passed = 0;
    int8:failed = 0;
    
    // Test 1: IF/ELSE (x > 10)
    int8:r1 = test_if_else(15)?;
    IF(r1, ==, 1)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Test 1b: IF/ELSE (x <= 10)
    int8:r1b = test_if_else(5)?;
    IF(r1b, ==, 0)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Test 2: ELIF (x == 2)
    int8:r2 = test_elif(2)?;
    IF(r2, ==, 20)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Test 3: WHILE loop (sum 0+1+2+3+4 = 10)
    int32:r3 = test_while()?;
    IF(r3, ==, 10)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Test 4: Nested IF (10 < x < 50)
    int8:r4 = test_nested(20)?;
    IF(r4, ==, 1)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Test 4b: Nested IF (x <= 10)
    int8:r4b = test_nested(5)?;
    IF(r4b, ==, 0)
        passed = passed + 1;
    ELSE
        failed = failed + 1;
    END_IF
    
    // Return 0 if all passed, 1 otherwise
    IF(passed, ==, 6)
        return 0;
    ELSE
        return 1;
    END_IF
};
