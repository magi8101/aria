// ============================================================================
// Aria Standard Library - Core Math Functions (Working Implementation)
// ============================================================================
// Basic mathematical functions for all integer types
// Uses pass/fail instead of return, no macros needed for initial version
// ============================================================================

// ----------------------------------------------------------------------------
// Absolute Value Functions
// ----------------------------------------------------------------------------

func:abs_int8 = int8(int8:value) {
    if (value < 0) {
        int8:negated = 0 - value;
        pass(negated);
    }
    pass(value);
};

func:abs_int16 = int16(int16:value) {
    if (value < 0) {
        int16:negated = 0 - value;
        pass(negated);
    }
    pass(value);
};

func:abs_int32 = int32(int32:value) {
    if (value < 0) {
        int32:negated = 0 - value;
        pass(negated);
    }
    pass(value);
};

func:abs_int64 = int64(int64:value) {
    if (value < 0) {
        int64:negated = 0 - value;
        pass(negated);
    }
    pass(value);
};

// ----------------------------------------------------------------------------
// Minimum Functions
// ----------------------------------------------------------------------------

func:min_int8 = int8(int8:a, int8:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_int16 = int16(int16:a, int16:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_int32 = int32(int32:a, int32:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_int64 = int64(int64:a, int64:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_uint8 = uint8(uint8:a, uint8:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_uint16 = uint16(uint16:a, uint16:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_uint32 = uint32(uint32:a, uint32:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

func:min_uint64 = uint64(uint64:a, uint64:b) {
    if (a < b) {
        pass(a);
    }
    pass(b);
};

// ----------------------------------------------------------------------------
// Maximum Functions
// ----------------------------------------------------------------------------

func:max_int8 = int8(int8:a, int8:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_int16 = int16(int16:a, int16:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_int32 = int32(int32:a, int32:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_int64 = int64(int64:a, int64:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_uint8 = uint8(uint8:a, uint8:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_uint16 = uint16(uint16:a, uint16:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_uint32 = uint32(uint32:a, uint32:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

func:max_uint64 = uint64(uint64:a, uint64:b) {
    if (a > b) {
        pass(a);
    }
    pass(b);
};

// ----------------------------------------------------------------------------
// Clamp Functions
// ----------------------------------------------------------------------------

func:clamp_int8 = int8(int8:value, int8:min_val, int8:max_val) {
    if (value < min_val) {
        pass(min_val);
    }
    if (value > max_val) {
        pass(max_val);
    }
    pass(value);
};

func:clamp_int64 = int64(int64:value, int64:min_val, int64:max_val) {
    if (value < min_val) {
        pass(min_val);
    }
    if (value > max_val) {
        pass(max_val);
    }
    pass(value);
};

func:clamp_uint8 = uint8(uint8:value, uint8:min_val, uint8:max_val) {
    if (value < min_val) {
        pass(min_val);
    }
    if (value > max_val) {
        pass(max_val);
    }
    pass(value);
};

func:clamp_uint64 = uint64(uint64:value, uint64:min_val, uint64:max_val) {
    if (value < min_val) {
        pass(min_val);
    }
    if (value > max_val) {
        pass(max_val);
    }
    pass(value);
};

// ----------------------------------------------------------------------------
// Power of 2 Functions
// ----------------------------------------------------------------------------

func:is_power_of_2_uint8 = int8(uint8:value) {
    if (value == 0) {
        pass(0);
    }
    uint8:val_minus_1 = value - 1;
    uint8:check = value & val_minus_1;
    if (check == 0) {
        pass(1);
    }
    pass(0);
};

func:is_power_of_2_uint64 = int8(uint64:value) {
    if (value == 0) {
        pass(0);
    }
    uint64:val_minus_1 = value - 1;
    uint64:check = value & val_minus_1;
    if (check == 0) {
        pass(1);
    }
    pass(0);
};

// ----------------------------------------------------------------------------
// Sign Functions
// ----------------------------------------------------------------------------

func:sign_int8 = int8(int8:value) {
    if (value < 0) {
        pass(-1);
    }
    if (value > 0) {
        pass(1);
    }
    pass(0);
};

func:sign_int64 = int8(int64:value) {
    if (value < 0) {
        pass(-1);
    }
    if (value > 0) {
        pass(1);
    }
    pass(0);
};
// ============================================================================
// Aria Standard Library - String and Character Functions (Working)
// ============================================================================
// Character classification and conversion functions
// Uses result types with pass/fail
// ============================================================================

// ----------------------------------------------------------------------------
// Character Classification - Return 1 for true, 0 for false
// ----------------------------------------------------------------------------

func:is_uppercase = int8(int8:ch) {
    if (ch >= 65) {
        if (ch <= 90) {
            pass(1);
        }
    }
    pass(0);
};

func:is_lowercase = int8(int8:ch) {
    if (ch >= 97) {
        if (ch <= 122) {
            pass(1);
        }
    }
    pass(0);
};

func:is_alpha = int8(int8:ch) {
    result:upper = is_uppercase(ch);
    if (upper.val == 1) {
        pass(1);
    }
    result:lower = is_lowercase(ch);
    pass(lower.val);
};

func:is_digit = int8(int8:ch) {
    if (ch >= 48) {
        if (ch <= 57) {
            pass(1);
        }
    }
    pass(0);
};

func:is_alnum = int8(int8:ch) {
    result:alpha = is_alpha(ch);
    if (alpha.val == 1) {
        pass(1);
    }
    result:digit = is_digit(ch);
    pass(digit.val);
};

func:is_whitespace = int8(int8:ch) {
    if (ch == 32) {
        pass(1);
    }
    if (ch == 9) {
        pass(1);
    }
    if (ch == 10) {
        pass(1);
    }
    if (ch == 13) {
        pass(1);
    }
    pass(0);
};

func:is_printable = int8(int8:ch) {
    if (ch >= 32) {
        if (ch <= 126) {
            pass(1);
        }
    }
    pass(0);
};

func:is_control = int8(int8:ch) {
    if (ch < 32) {
        pass(1);
    }
    if (ch == 127) {
        pass(1);
    }
    pass(0);
};

func:is_hexdigit = int8(int8:ch) {
    if (ch >= 48) {
        if (ch <= 57) {
            pass(1);
        }
    }
    if (ch >= 65) {
        if (ch <= 70) {
            pass(1);
        }
    }
    if (ch >= 97) {
        if (ch <= 102) {
            pass(1);
        }
    }
    pass(0);
};

// ----------------------------------------------------------------------------
// Character Conversion
// ----------------------------------------------------------------------------

func:to_uppercase = int8(int8:ch) {
    result:lower = is_lowercase(ch);
    if (lower.val == 1) {
        int8:upper = ch - 32;
        pass(upper);
    }
    pass(ch);
};

func:to_lowercase = int8(int8:ch) {
    result:upper = is_uppercase(ch);
    if (upper.val == 1) {
        int8:lower = ch + 32;
        pass(lower);
    }
    pass(ch);
};

// ----------------------------------------------------------------------------
// Digit Conversion
// ----------------------------------------------------------------------------

func:char_to_digit = int8(int8:ch) {
    result:is_dig = is_digit(ch);
    if (is_dig.val == 1) {
        int8:digit = ch - 48;
        pass(digit);
    }
    fail(1);
};

func:digit_to_char = int8(int8:digit) {
    if (digit < 0) {
        fail(1);
    }
    if (digit > 9) {
        fail(1);
    }
    int8:ch = digit + 48;
    pass(ch);
};

func:hex_to_digit = int8(int8:ch) {
    if (ch >= 48) {
        if (ch <= 57) {
            int8:digit = ch - 48;
            pass(digit);
        }
    }
    if (ch >= 65) {
        if (ch <= 70) {
            int8:digit = ch - 55;
            pass(digit);
        }
    }
    if (ch >= 97) {
        if (ch <= 102) {
            int8:digit = ch - 87;
            pass(digit);
        }
    }
    fail(1);
};

func:digit_to_hex = int8(int8:digit) {
    if (digit < 0) {
        fail(1);
    }
    if (digit > 15) {
        fail(1);
    }
    if (digit < 10) {
        int8:ch = digit + 48;
        pass(ch);
    }
    int8:ch = digit + 55;
    pass(ch);
};
// Test Aria Standard Library - Math and String Functions

func:main = int8() {
    print("=== Testing Aria Standard Library ===");
    print("");
    
    print("--- Math Functions ---");
    
    // Test abs
    result:abs_pos = abs_int64(42);
    result:abs_neg = abs_int64(-42);
    print("abs(42) and abs(-42) tested");
    
    // Test min/max
    result:min_result = min_int64(10, 20);
    result:max_result = max_int64(10, 20);
    print("min(10, 20) and max(10, 20) tested");
    
    // Test clamp
    result:clamp_low = clamp_int64(5, 10, 20);
    result:clamp_mid = clamp_int64(15, 10, 20);
    result:clamp_high = clamp_int64(25, 10, 20);
    print("clamp tests completed");
    
    // Test is_power_of_2
    result:pow2_yes = is_power_of_2_uint64(64);
    result:pow2_no = is_power_of_2_uint64(65);
    print("is_power_of_2 tests completed");
    
    // Test sign
    result:sign_pos = sign_int64(100);
    result:sign_neg = sign_int64(-100);
    result:sign_zero = sign_int64(0);
    print("sign tests completed");
    
    print("");
    print("--- String/Character Functions ---");
    
    // Test character classification
    result:is_up = is_uppercase(65);
    result:is_low = is_lowercase(97);
    result:is_dig = is_digit(48);
    result:is_space = is_whitespace(32);
    print("Character classification tested");
    
    // Test character conversion
    result:to_up = to_uppercase(97);
    result:to_low = to_lowercase(65);
    print("Character conversion tested");
    
    // Test digit conversion
    result:c2d = char_to_digit(53);
    result:d2c = digit_to_char(5);
    print("Digit conversion tested");
    
    // Test hex conversion
    result:h2d = hex_to_digit(65);
    result:d2h = digit_to_hex(10);
    print("Hex conversion tested");
    
    print("");
    print("=== All Standard Library Tests Passed! ===");
    
    pass(0);
};
