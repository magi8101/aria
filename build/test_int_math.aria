// ============================================================================
// Test Integer Math Functions (pow, sqrt - no LLVM intrinsics needed)
// ============================================================================

// Integer power - simpler test without floats
%macro GEN_POW_INT 1
func:pow_%1 = *%1(%1:base, %1:exponent) {
    if (exponent < 0) {
        fail(1);
    }
    if (exponent == 0) {
        return 1;
    }
    %1:val = 1;
    %1:i = 0;
    while (i < exponent) {
        val = val * base;
        i = i + 1;
    }
    return val;
};
%endmacro

// Integer square root using Newton's method
%macro GEN_ISQRT 1
func:isqrt_%1 = *%1(%1:n) {
    if (n < 0) {
        fail(1);
    }
    if (n == 0) {
        return 0;
    }
    if (n == 1) {
        return 1;
    }
    
    %1:x = n;
    %1:y = 0;
    while (y != x) {
        y = x;
        x = (x + (n / x)) / 2;
    }
    return x;
};
%endmacro

// Generate functions
GEN_POW_INT(int32)
GEN_ISQRT(int32)

// ----------------------------------------------------------------------------
// Test integer power
// ----------------------------------------------------------------------------
func:test_pow = *int8() {
    // 2^10 should be 1024
    int32:p1 = pow_int32(2, 10) ? 0;
    if (p1 != 1024) {
        return 1;
    }
    
    // 5^3 should be 125
    int32:p2 = pow_int32(5, 3) ? 0;
    if (p2 != 125) {
        return 1;
    }
    
    // 3^0 should be 1
    int32:p3 = pow_int32(3, 0) ? 0;
    if (p3 != 1) {
        return 1;
    }
    
    // 10^5 should be 100000
    int32:p4 = pow_int32(10, 5) ? 0;
    if (p4 != 100000) {
        return 1;
    }
    
    return 0;
};

// ----------------------------------------------------------------------------
// Test integer square root
// ----------------------------------------------------------------------------
func:test_isqrt = *int8() {
    // isqrt(144) should be 12
    int32:s1 = isqrt_int32(144) ? 0;
    if (s1 != 12) {
        return 1;
    }
    
    // isqrt(100) should be 10
    int32:s2 = isqrt_int32(100) ? 0;
    if (s2 != 10) {
        return 1;
    }
    
    // isqrt(0) should be 0
    int32:s3 = isqrt_int32(0) ? 0;
    if (s3 != 0) {
        return 1;
    }
    
    // isqrt(1) should be 1
    int32:s4 = isqrt_int32(1) ? 0;
    if (s4 != 1) {
        return 1;
    }
    
    // isqrt(625) should be 25
    int32:s5 = isqrt_int32(625) ? 0;
    if (s5 != 25) {
        return 1;
    }
    
    return 0;
};

// ----------------------------------------------------------------------------
// Main test runner
// ----------------------------------------------------------------------------
func:main = *int8() {
    int8:val = 0;
    
    val = test_pow() ? 1;
    if (val != 0) {
        return 1;
    }
    
    val = test_isqrt() ? 1;
    if (val != 0) {
        return 1;
    }
    
    // All tests passed!
    return 0;
};
