// Combined test - includes math library inline

// ----------------------------------------------------------------------------
// Integer Power Functions
// ----------------------------------------------------------------------------

%macro GEN_POW_INT 1
func:pow_%1 = *%1(%1:base, %1:exponent) {
    if (exponent < 0) {
        fail(1);
    }
    if (exponent == 0) {
        return 1;
    }
    %1:result_val = 1;
    %1:i = 0;
    while (i < exponent) {
        result_val = result_val * base;
        i = i + 1;
    }
    return result_val;
};
%endmacro

GEN_POW_INT(int32)
GEN_POW_INT(uint32)

// ----------------------------------------------------------------------------
// Integer Square Root Functions
// ----------------------------------------------------------------------------

%macro GEN_ISQRT 1
func:isqrt_%1 = *%1(%1:n) {
    if (n < 0) {
        fail(1);
    }
    if (n == 0) {
        return 0;
    }
    if (n == 1) {
        return 1;
    }
    
    %1:x = n;
    %1:y = 0;
    while (y != x) {
        y = x;
        x = (x + (n / x)) / 2;
    }
    return x;
};
%endmacro

GEN_ISQRT(int32)

// ----------------------------------------------------------------------------
// Tests
// ----------------------------------------------------------------------------

func:test_pow = *int8() {
    int32:result = pow_int32(2, 10) ? 0;
    if (result != 1024) {
        return 1;
    }
    
    int32:result2 = pow_int32(5, 3) ? 0;
    if (result2 != 125) {
        return 2;
    }
    
    int32:result3 = pow_int32(10, 0) ? 0;
    if (result3 != 1) {
        return 3;
    }
    
    return 0;
};

func:test_isqrt = *int8() {
    int32:result = isqrt_int32(144) ? 0;
    if (result != 12) {
        return 1;
    }
    
    int32:result2 = isqrt_int32(100) ? 0;
    if (result2 != 10) {
        return 2;
    }
    
    int32:result3 = isqrt_int32(1) ? 0;
    if (result3 != 1) {
        return 3;
    }
    
    return 0;
};

func:main = *int8() {
    int8:r1 = test_pow() ? 0;
    if (r1 != 0) {
        return r1;
    }
    
    int8:r2 = test_isqrt() ? 0;
    if (r2 != 0) {
        return r2 + 10;
    }
    
    return 0;
};
