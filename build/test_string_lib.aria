// ============================================================================
// Test Suite: String Library Character Functions
// ============================================================================

// Import string library (inline for testing)
// In production: use stdlib.string;

// Character classification
func:is_uppercase = *int8(int8:ch) {
    if (ch >= 65) {
        if (ch <= 90) {
            return 1;
        }
    }
    return 0;
};

func:is_lowercase = *int8(int8:ch) {
    if (ch >= 97) {
        if (ch <= 122) {
            return 1;
        }
    }
    return 0;
};

func:is_digit = *int8(int8:ch) {
    if (ch >= 48) {
        if (ch <= 57) {
            return 1;
        }
    }
    return 0;
};

func:to_lowercase = *int8(int8:ch) {
    int8:upper = is_uppercase(ch) ? 0;
    if (upper == 1) {
        return ch + 32;
    }
    return ch;
};

func:to_uppercase = *int8(int8:ch) {
    int8:lower = is_lowercase(ch) ? 0;
    if (lower == 1) {
        return ch - 32;
    }
    return ch;
};

func:digit_to_int = *int8(int8:ch) {
    int8:valid = is_digit(ch) ? 0;
    if (valid == 0) {
        fail(1);
    }
    return ch - 48;
};

func:int_to_digit = *int8(int8:n) {
    if (n < 0) {
        fail(1);
    }
    if (n > 9) {
        fail(1);
    }
    return n + 48;
};

// ----------------------------------------------------------------------------
// Test character classification
// ----------------------------------------------------------------------------
func:test_char_classification = *int8() {
    // Test is_uppercase
    int8:r1 = is_uppercase(65) ? 0;  // 'A'
    if (r1 != 1) {
        return 1;
    }
    
    int8:r2 = is_uppercase(97) ? 0;  // 'a'
    if (r2 != 0) {
        return 1;
    }
    
    // Test is_lowercase
    int8:r3 = is_lowercase(97) ? 0;  // 'a'
    if (r3 != 1) {
        return 1;
    }
    
    int8:r4 = is_lowercase(65) ? 0;  // 'A'
    if (r4 != 0) {
        return 1;
    }
    
    // Test is_digit
    int8:r5 = is_digit(48) ? 0;  // '0'
    if (r5 != 1) {
        return 1;
    }
    
    int8:r6 = is_digit(57) ? 0;  // '9'
    if (r6 != 1) {
        return 1;
    }
    
    int8:r7 = is_digit(65) ? 0;  // 'A'
    if (r7 != 0) {
        return 1;
    }
    
    return 0;
};

// ----------------------------------------------------------------------------
// Test character conversion
// ----------------------------------------------------------------------------
func:test_char_conversion = *int8() {
    // Test to_lowercase
    int8:lower_a = to_lowercase(65) ? 0;  // 'A' -> 'a'
    if (lower_a != 97) {
        return 1;
    }
    
    int8:lower_z = to_lowercase(90) ? 0;  // 'Z' -> 'z'
    if (lower_z != 122) {
        return 1;
    }
    
    int8:already_lower = to_lowercase(97) ? 0;  // 'a' -> 'a'
    if (already_lower != 97) {
        return 1;
    }
    
    // Test to_uppercase
    int8:upper_a = to_uppercase(97) ? 0;  // 'a' -> 'A'
    if (upper_a != 65) {
        return 1;
    }
    
    int8:upper_z = to_uppercase(122) ? 0;  // 'z' -> 'Z'
    if (upper_z != 90) {
        return 1;
    }
    
    int8:already_upper = to_uppercase(65) ? 0;  // 'A' -> 'A'
    if (already_upper != 65) {
        return 1;
    }
    
    return 0;
};

// ----------------------------------------------------------------------------
// Test digit conversion
// ----------------------------------------------------------------------------
func:test_digit_conversion = *int8() {
    // Test digit_to_int
    int8:d0 = digit_to_int(48) ? -1;  // '0' -> 0
    if (d0 != 0) {
        return 1;
    }
    
    int8:d5 = digit_to_int(53) ? -1;  // '5' -> 5
    if (d5 != 5) {
        return 1;
    }
    
    int8:d9 = digit_to_int(57) ? -1;  // '9' -> 9
    if (d9 != 9) {
        return 1;
    }
    
    // Test int_to_digit
    int8:c0 = int_to_digit(0) ? 0;  // 0 -> '0'
    if (c0 != 48) {
        return 1;
    }
    
    int8:c5 = int_to_digit(5) ? 0;  // 5 -> '5'
    if (c5 != 53) {
        return 1;
    }
    
    int8:c9 = int_to_digit(9) ? 0;  // 9 -> '9'
    if (c9 != 57) {
        return 1;
    }
    
    return 0;
};

// ----------------------------------------------------------------------------
// Main test runner
// ----------------------------------------------------------------------------
func:main = *int8() {
    int8:result_val = 0;
    
    result_val = test_char_classification() ? 1;
    if (result_val != 0) {
        return 1;
    }
    
    result_val = test_char_conversion() ? 1;
    if (result_val != 0) {
        return 1;
    }
    
    result_val = test_digit_conversion() ? 1;
    if (result_val != 0) {
        return 1;
    }
    
    // All tests passed!
    return 0;
};
