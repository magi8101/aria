// Test when loops with then/end blocks
func:test_when_success = *int8() {
    int8:count = 0;
    int8:ret = 0;
    when(count < 3) {
        count = count + 1;
    } then {
        ret = 100;  // This should execute (loop completes)
    } end {
        ret = -1;   // This should NOT execute
    }
    return ret;  // Should be 100
};

func:test_when_break = *int8() {
    int8:count = 0;
    int8:ret = 0;
    when(count < 10) {
        count = count + 1;
        if(count == 3){
            break;
        }
    } then {
        ret = 100;  // This should NOT execute
    } end {
        ret = -1;   // This should execute (loop broke)
    }
    return ret;  // Should be -1
};

func:test_when_no_blocks = *int8() {
    int8:count = 0;
    int8:sum = 0;
    when(count < 5) {
        sum = sum + count;
        count = count + 1;
    }
    return sum;  // Should be 0+1+2+3+4 = 10
};

func:main = *int8() {
    int8:r1 = test_when_success() ? -1;   // 100
    int8:r2 = test_when_break() ? -1;     // -1
    int8:r3 = test_when_no_blocks() ? -1; // 10
    return 0;
};
